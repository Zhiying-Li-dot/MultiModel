# PVTT Test 02: Noisy RefDrop Experiment
# Bracelet to Necklace with Noisy Reference Self-Attention
#
# Key difference from Clean RefDrop:
# - Clean: Extract features at t=0, reuse for all steps
# - Noisy: Add noise to reference matching current timestep
#
# This should fix feature distribution mismatch at high noise levels.

model_id: Wan-AI/Wan2.1-T2V-1.3B-Diffusers

video:
    video_path: ./videos/bracelet_shot1.mp4
    source_prompt: Two personalized couple bracelets, one silver and one black, placed on a purple silk fabric with decorative stones.
    # Prompt matches reference image (pearl necklace)
    target_prompt: A gold chain necklace with white pearl drop pendants and red gemstone accents placed on a purple silk fabric with decorative stones.
    source_blend: bracelets
    target_blend: necklace
    # Target product image (JEWE005 = gold necklace with pearls)
    target_image: ../../data/pvtt-benchmark/images/jewelry/JEWE005_source.jpg

infernece:
    num_inference_step: 50

training-free-type:
    flag_flowedit: True
    flag_flowalign: False

flowedit:
    strength: 0.7
    target_guidance_scale: 13.5
    source_guidance_scale: 5.0
    # Noisy RefDrop parameters
    use_reference_attention: True
    noisy_refdrop: True       # NEW: Use noisy reference (not clean)
    ref_c: 0.05               # Same as best clean RefDrop for fair comparison
    save_video: ../../experiments/results/flowedit-wan2.1/test02_noisy_refdrop_c0.05.mp4

flowalign:
    strength: 0.7
    target_guidance_scale: 19.5
    flag_attnmask: True
    zeta_scale: 1e-3
    bg_zeta_scale: 1e-3
    save_video: ../../experiments/results/flowalign-wan2.1/test02_noisy_refdrop.mp4
